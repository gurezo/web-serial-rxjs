<div class="container">
  <header>
    <h1>Web Serial RxJS - Angular Example</h1>
    <p class="subtitle">Angular Service を使用した Web Serial API のサンプル</p>
  </header>

  <main>
    <!-- ブラウザサポート -->
    <section class="section">
      <h2>ブラウザサポート</h2>
      <div
        class="status-message"
        [ngClass]="(browserSupported$ | async) ? 'success' : 'error'"
      >
        {{ (browserSupported$ | async) ? 'ブラウザは Web Serial API
        をサポートしています。' : 'このブラウザは Web Serial API
        をサポートしていません。Chrome、Edge、Opera などの Chromium
        ベースのブラウザをご使用ください。' }}
      </div>
    </section>

    <!-- 接続設定 -->
    <section class="section">
      <h2>接続設定</h2>
      <div class="form-group">
        <label for="baud-rate">ボーレート</label>
        <select
          id="baud-rate"
          class="form-control"
          [(ngModel)]="baudRate"
          [disabled]="getConnected(connectionState$ | async)"
        >
          <option [value]="9600">9600</option>
          <option [value]="19200">19200</option>
          <option [value]="38400">38400</option>
          <option [value]="57600">57600</option>
          <option [value]="115200">115200</option>
        </select>
      </div>
      <div class="button-group">
        <button
          class="btn btn-outline"
          (click)="handleRequestPort()"
          [disabled]="
            !getBrowserSupported(browserSupported$ | async) ||
            getConnected(connectionState$ | async) ||
            getConnecting(connectionState$ | async)
          "
        >
          ポートを選択
        </button>
        <button
          class="btn btn-primary"
          (click)="handleConnect()"
          [disabled]="
            !getBrowserSupported(browserSupported$ | async) ||
            getConnected(connectionState$ | async) ||
            getConnecting(connectionState$ | async)
          "
        >
          接続
        </button>
        <button
          class="btn btn-secondary"
          (click)="handleDisconnect()"
          [disabled]="
            !getConnected(connectionState$ | async) ||
            getDisconnecting(connectionState$ | async)
          "
        >
          切断
        </button>
      </div>
      <div class="status-message" [ngClass]="(status$ | async)?.type">
        {{ (status$ | async)?.message }}
      </div>
    </section>

    <!-- データ送信 -->
    <section class="section">
      <h2>データ送信</h2>
      <div class="form-group">
        <label for="send-input">送信データ</label>
        <div class="input-group">
          <input
            id="send-input"
            type="text"
            class="form-control"
            [(ngModel)]="sendInput"
            (keydown)="handleKeyDown($event)"
            [disabled]="!getConnected(connectionState$ | async)"
            placeholder="送信するテキストを入力..."
          />
          <button
            class="btn btn-primary"
            (click)="handleSend()"
            [disabled]="
              !getConnected(connectionState$ | async) || !sendInput.trim()
            "
          >
            送信
          </button>
        </div>
      </div>
    </section>

    <!-- データ受信 -->
    <section class="section">
      <h2>データ受信</h2>
      <div class="form-group">
        <label for="receive-output">受信データ</label>
        <textarea
          id="receive-output"
          class="form-control receive-output"
          [value]="receivedData$ | async"
          readonly
          placeholder="受信したデータがここに表示されます..."
        ></textarea>
      </div>
      <div class="button-group">
        <button
          class="btn btn-secondary"
          (click)="clearReceivedData()"
          [disabled]="!hasReceivedData(receivedData$ | async)"
        >
          クリア
        </button>
      </div>
    </section>
  </main>
</div>
